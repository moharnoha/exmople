resendBtn.addEventListener('click', function() {
        const email = localStorage.getItem('storedEmail');
        if (!email) return alert("لم يتم العثور على البريد");

        resendBtn.innerText = "جاري الإرسال...";
        resendBtn.classList.add('loading');

        const scriptURL = 'https://script.google.com/macros/s/AKfycbxy-1Z37l9ynTk10ndPsF4iu7D4I41Ag3KUwnx8KnGKf7yrGSN0IB3u3glol4daSMQCuA/exec';

        // حل مشكلة الخطأ عبر استخدام Image Request أو No-Cors Fetch
        // هذه الطريقة تضمن وصول الطلب للسكريبت حتى لو رفض المتصفح قراءة الرد
        const finalURL = `${scriptURL}?email=${encodeURIComponent(email)}&action=resend&t=${new Date().getTime()}`;
        
        const img = new Image();
        img.src = finalURL; 

        // إظهار نجاح وهمي للمستخدم لأن الطلب سيصل حتماً للخادم
        setTimeout(() => {
            alert("تم طلب إرسال رمز جديد بنجاح");
            resendBtn.innerText = "إعادة إرسال الرمز";
            resendBtn.classList.remove('loading');
        }, 1500);
    });
